#!/bin/bash

echocol() { echo -e "\033[32m*** $@...\033[0m"; }

echocol "Cleanup running containers"
( [[ $(docker ps -qa | wc -l) -gt 0 ]] && docker rm -f $(docker ps -qa) ) >/dev/null 2>&1

echocol "Building images"
( ./bin/build ) >/dev/null 2>&1

. ./bin/set_addresses

echocol "Starting servers"
./bin/runtserver
./bin/runarbiter

echocol "Starting a few workers"

for i in $(seq 0 9); do
	echo "worker $i, uid:signature = " $(docker run --rm -v $(pwd)/bin/runcodebox:/runcodebox -e ARBITER_ADDRESS=$ARBITER_ADDRESS dockerfile/python /runcodebox -d)
done
